<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<title>订阅列表</title>
<link rel="stylesheet" th:href="@{/layui/css/layui.css}">
</head>
<body class="layui-layout-body">
	<div class="layui-layout layui-layout-admin">
		<div data-th-replace="~{layout :: header}"></div>
		<div class="layui-body" style="left: 10px;top:10px">
			<!-- 内容主体区域 -->
			<div>

			</div>
			<table class="layui-table">
				<colgroup>
					<col width="100">
					<col width="200">
					<col>
				</colgroup>
				<thead>
					<tr>
						<th><b>顺序号</b></th>
						<th><b>订阅账号</b></th>
						<th><b>订阅时间</b></th>
						<th><b>操作</b></th>
					</tr>
				</thead>
				<tbody>
					<tr data-th-each="item, iterStat : ${data}">
						<td data-th-text="${iterStat.count}+${pageIndex-1}*${pageSize}"></td>
						<td data-th-text="${item.userId}"></td>
						<td data-th-text="${item.createTime}" class="date"></td>
						<td></td>
					</tr>
				</tbody>
			</table>

			<div id="pageContent"></div>
		</div>

		<div class="layui-footer">
			<!-- 底部固定区域 -->

		</div>
	</div>
	<!-- <script src="/layui/jquery.min.js"></script>
<script src="/layui/layui.js"></script> -->
<script th:inline="javascript">
//JavaScript代码区域
var contextRoot = /*[[@{/}]]*/ '';
layui.use('laypage', function(){
  var laypage = layui.laypage;
  //执行一个laypage实例
  laypage.render({
	  elem: 'pageContent'
	  ,count:[[${total}]] //数据总数，从服务端得到
	  ,curr: [[${pageIndex}]]	
	  ,layout:['count','prev', 'page', 'next','skip']
	  ,jump: function(obj, first){
		  console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
		  console.log(obj.limit); //得到每页显示的条数
	    //首次不执行
	   if(!first || [[${pageIndex}]] != obj.curr){
	      window.location.href = contextRoot+'/manage/publisher/listSub?pageIndex=' + obj.curr + "&pageSize=" + obj.limit +
	      						"&" + $("#searchFrom").serialize();
	    } 
	  }
	}); 
});
function del(id){
	layer.confirm("你确定要删除该社区吗？",function(index) {
		$.ajax({
			type : "POST",
			data : {'id':id},
			url : contextRoot+"/community/del",
			dataType : "json",
			success : function(msg) {
				console.log(msg);
				if (msg.meta.code == 0) {
					layer.msg("删除成功!");
					window.location.reload();
				} else {
					layer.msg(msg.meta.message);
				}
			}
		});
	});
}
function edit(dateId){
	layer.open({
		type: 2,
		resize:false,
		title: "编辑社区",
		area: ['90%',"90%"],
		content: contextRoot+"/community/edit_view?id=" + dateId, //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
		btn:['保存','取消'],
		yes:function(index){
			save(index);
		},
		cancel:function(){}
	});
}
/**
 * 添加推荐问题
 */
function add(){
	layer.open({
		type: 2,
		resize:false,
		title: "新增社区",
		area: ['90%',"90%"],
		content: contextRoot+"/community/edit_view", //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
		btn:['保存','取消'],
		yes:function(index){
			save(index);
		},
		cancel:function(){}
	});
}
/**
 * 保存标签
 */
function save(index){
	layer.confirm('确定要添加该社区吗?',function(index) {
		var obj = $("iframe").contents().find("#addForm").serialize();
		$.ajax({
			type : "POST",
			data : obj,
			url : contextRoot+"/community/add_and_edit",
			dataType : "json",
			success : function(msg) {
				console.log(msg);
				if (msg.meta.code == 0) {
					layer.msg("添加成功!");
					layer.close(index);
					window.location.reload();
				} else {
					layer.msg(msg.meta.message);
				}
			}
		});
	});
}
/**
 * 更新操作
 */
function updatePublish(publish,dateId){
	layer.confirm("你确定哪个要更新该上架状态吗？",function(index) {
		$.ajax({
			type : "POST",
			data : {"id":dateId,"publish":publish},
			url : contextRoot+"/community/update_publish",
			dataType : "json",
			success : function(msg) {
				console.log(msg);
				if (msg.meta.code == 0) {
					layer.msg("操作成功!");
					layer.close(index);
					window.location.reload();
				} else {
					layer.msg(msg.meta.message);
				}
			}
		});
	});
}
</script>
</body>
<script type="text/javascript" th:src="@{/common.js}"></script>
</html>