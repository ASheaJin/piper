<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<title>出版社管理</title>
<link rel="stylesheet" th:href="@{/layui/css/layui.css}">
</head>
<body class="layui-layout-body">
	<div class="layui-layout layui-layout-admin">
		<div data-th-replace="~{layout :: header}"></div>
		<div class="layui-body" style="left: 10px;top:10px">
			<!-- 内容主体区域 -->
			<div>
				<form id="searchFrom" class="layui-form layui-form-pane" th:action="@{/manage/publisher/list}" method="post">
					<div class="layui-form-item">
						<div class="layui-inline">
							<label class="layui-form-label">作者账号</label>
							<div class="layui-input-inline">
								<input name="userId" placeholder="作者账号" class="layui-input" th:value="${userId != null ? userId : ''}" maxlength="30">
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">出版社账号</label>
							<div class="layui-input-inline">
								<input name="ptmail" placeholder="出版社账号" class="layui-input" th:value="${ptmail != null ? ptmail : ''}" maxlength="30">
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">出版社名称</label>
							<div class="layui-input-inline">
								<input name="name" placeholder="出版社名称" class="layui-input" th:value="${name != null ? name : ''}" maxlength="30">
							</div>
						</div>
						<button type="submit" class="layui-btn">查询</button>
						<!--<a class="layui-btn" style="right: 20px;position: absolute;" href="javascript:void(0)" onclick="add()">新增</a>-->
					</div>
				</form>
			</div>
			<table class="layui-table">
				<colgroup>
					<col width="100">
					<col width="200">
					<col>
				</colgroup>
				<thead>
					<tr>
						<th><b>顺序号</b></th>
						<th><b>作者账号</b></th>
						<th><b>出版社账号</b></th>
						<th><b>名称</b></th>
						<th><b>头像</b></th>
						<th><b>创建时间</b></th>
						<th><b>操作</b></th>
					</tr>
				</thead>
				<tbody>
					<tr data-th-each="item, iterStat : ${data}">
						<td data-th-text="${iterStat.count}+${pageIndex-1}*${pageSize}"></td>
						<td data-th-text="${item.userId}"></td>
						<td data-th-text="${item.ptemail}"></td>
						<td data-th-text="${item.name}"></td>
						<td data-th-text="${item.avatar}"></td>
						<td data-th-text="${item.createTime}" class="date"></td>
						<td>
                            <a class="layui-btn layui-btn-xs" th:onclick="'javascript:listSub(' + ${item.publisherId} + ');'">订阅列表</a>
                            <a class="layui-btn layui-btn-xs" th:onclick="'javascript:listContent(' + ${item.publisherId} + ');'">文章列表</a>

                        </td>
					</tr>
				</tbody>
			</table>

			<div id="pageContent"></div>
		</div>

		<div class="layui-footer">
			<!-- 底部固定区域 -->

		</div>
	</div>
	<!-- <script src="/layui/jquery.min.js"></script>
<script src="/layui/layui.js"></script> -->
<script th:inline="javascript">
//JavaScript代码区域
var curWwwPath = window.document.location.href;
//获取主机地址之后的目录，如： uimcardprj/share/meun.jsp
var pathName = window.document.location.pathname;
var pos = curWwwPath.indexOf(pathName);
//获取主机地址，如： http://localhost:8083
var contextRoot = curWwwPath.substring(0, pos);

layui.use('laypage', function(){
    var laypage = layui.laypage;
    //执行一个laypage实例
    laypage.render({
        elem: 'pageContent'
        ,count:[[${total}]] //数据总数，从服务端得到
        ,curr: [[${pageIndex}]]
        ,layout:['count','prev', 'page', 'next','skip']
        ,jump: function(obj, first){
            console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
            console.log(obj.limit); //得到每页显示的条数
            //首次不执行
            if(!first || [[${pageIndex}]] != obj.curr){
                window.location.href = contextRoot+'/manage/publisher/list?pageIndex=' + obj.curr + "&pageSize=" + obj.limit +
                    "&" + $("#searchFrom").serialize();
            }
        }
    });
});

function listSub(publisherId) {
    layer.open({
        type: 2,
        resize:false,
        title: "订阅列表",
        area: ['90%',"90%"],
        content: "/manage/publisher/listSub?publisherId=" + publisherId
    });
}

function listContent(publisherId) {
    layer.open({
        type: 2,
        resize:false,
        title: "文章列表",
        area: ['90%',"90%"],
        content: "/manage/content/list?publisherId=" + publisherId
    });
}
</script>
</body>
<script type="text/javascript" th:src="@{/common.js}"></script>
</html>